<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Text Encrypt/Decrypt</title>
<style>
body { font-family: Arial, sans-serif; margin: 40px; }
input, textarea { width: 100%; padding: 10px; margin-top: 10px; }
button { padding: 10px 20px; margin-top: 15px; cursor: pointer; }
.result { margin-top: 20px; padding: 10px; background: #f0f0f0; }
</style>
</head>
<body>
<h2>Encrypt / Decrypt Text</h2>

<label>Enter Text:</label>
<textarea id="plainText"></textarea>

<label>Password:</label>
<input type="password" id="password">

<button onclick="encrypt()">Encrypt</button>
<button onclick="decrypt()">Decrypt</button>

<div class="result">
<h3>Output:</h3>
<pre id="output"></pre>
</div>

<script>
getKey(password) {
    const enc = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
    );
    return crypto.subtle.deriveKey(
        {
            name: "PBKDF2",
            salt: enc.encode("fixed-salt"),
            iterations: 100000,
            hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
    );
}

function encrypt() {
    const text = document.getElementById("plainText").value;
    const password = document.getElementById("password").value;
    const output = document.getElementById("output");

    try {
        const key = await getKey(password);
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const enc = new TextEncoder();

        const encrypted = await crypto.subtle.encrypt(
            { name: "AES-GCM", iv },
            key,
            enc.encode(text)
        );

        const encryptedData = btoa(String.fromCharCode(...new Uint8Array(encrypted)));

        output.textContent = JSON.stringify({
            iv: Array.from(iv),
            data: encryptedData
        }, null, 2);
    } catch (err) {
        output.textContent = "Error: " + err;
    }
}

 function decrypt() {
    const input = document.getElementById("plainText").value;
    const password = document.getElementById("password").value;
    const output = document.getElementById("output");

    try {
        const encryptedObj = JSON.parse(input);
        const key = await getKey(password);

        const iv = new Uint8Array(encryptedObj.iv);
        const encryptedData = Uint8Array.from(
            atob(encryptedObj.data),
            c => c.charCodeAt(0)
        );

        const decrypted = await crypto.subtle.decrypt(
            { name: "AES-GCM", iv },
            key,
            encryptedData
        );

        output.textContent = new TextDecoder().decode(decrypted);
    } catch (err) {
        output.textContent = "Error: " + err;
    }
}
</script>
</body>
</html>
