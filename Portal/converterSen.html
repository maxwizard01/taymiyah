<!DOCTYPE html>
<html>
<head>
  <title>Excel to JSON</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>

<h3>Excel â†’ JSON Converter</h3>

<input type="file" id="excelFile" accept=".xlsx,.xls" />
<button onclick="convertExcel()">Generate JSON</button>
<button onclick="downloadJSON()">Download JSON</button>

<pre id="output"></pre>

<script >
  
  let finalJSON = [];
var allj=[]
function convertExcel() {
  const file = document.getElementById("excelFile").files[0];
  if (!file) return alert("Please upload an Excel file");

  const reader = new FileReader();

  reader.onload = e => {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });
    allj=rows
    finalJSON = rows.map(row => {
      /*const subjects = [];
      // Detect subjects dynamically
      Object.keys(row).forEach(col => {
        if (col.startsWith(" C.A")) {
          const subjectName = col.replace(" C.A", "");
          subjects.push({
            name: subjectName,
            "C.A Test": Number(row[col]) || 0,
            "EXAM": Number(row[subjectName + " EXAM"]) || 0
          });
        }
      });*/

 
    subjects=[
      {"name":"Mathematics",
    "C.A Test":row['Mathematics'],
    "EXAM":row["__EMPTY"],
    "Total":row["__EMPTY_1"]},

    {"name":"English Language",
    "C.A Test":row['English Language'],
    "EXAM":row["__EMPTY_2"],
    "Total":row["__EMPTY_3"]},
    
    {"name": "Yoruba",
    "C.A Test": row["Yoruba"],
    "EXAM":row["__EMPTY_4"],
    "Total":row["__EMPTY_5"]},


    {"name":"IRS",
    "C.A Test": row["IRS"],
    "EXAM":row["__EMPTY_6"],
    "Total":row["__EMPTY_7"]},
    
    {"name": "Arabic",
     "C.A Test": row['Arabic'],
    "EXAM":row["__EMPTY_8"],
    "Total":row["__EMPTY_9"]},

   {"name": "Quran",
    "C.A Test": row["Quran"],
    "EXAM":row["__EMPTY_10"],
    "Total":row["__EMPTY_11"]},

    {"name": "Civic/History",
    "C.A Test": row["Civic/History"],
    "EXAM":row["__EMPTY_12"],
    "Total":row["__EMPTY_13"]},

    {"name": "Phy/Lit/Acc",
    "C.A Test":row["Phy/Lit/Acc"],
    "EXAM":row["__EMPTY_14"],
    "Total":row["__EMPTY_15"]},

   {"name":"Chem/Gov/Comm",  

    "C.A Test": row["Chem/Gov/Comm"],
    "EXAM":row["__EMPTY_16"],
    "Total":row["__EMPTY_17"]},

    {"name":"Agric",
     "C.A Test": row["Agric"],
     "EXAM":row["__EMPTY_18"],
    "Total":row["__EMPTY_19"]},

    {"name":"Biology",
     "C.A Test": row["Biology"],
    "EXAM":row["__EMPTY_20"],
    "Total":row["__EMPTY_21"]},


    {"name":"Economics ",
    "C.A Test":row["Economics"],
    "EXAM":row["__EMPTY_22"],
    "Total":row["__EMPTY_23"]},
]

    console.log(row)
      return {
        "Roll No": String(row["Roll No."]),
        "name": row["Name"],
        "subjects": subjects,
      "Summary": {
    "TOTAL":row["Summary"],
    "average":row["__EMPTY_24"],
    "Position":row["__EMPTY_25"],
    "Class":row["__EMPTY_26"],
    "Sex":row["__EMPTY_27"] }
      };
    });

    document.getElementById("output").textContent =
      JSON.stringify(finalJSON, null, 2);
  };

  reader.readAsArrayBuffer(file);
}

function downloadJSON() {
  if (!finalJSON.length) return alert("Generate JSON first");

  const blob = new Blob(
    [JSON.stringify(finalJSON, null, 2)],
    { type: "application/json" }
  );

  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "student_results.json";
  link.click();
}

</script>
</body>
</html>
