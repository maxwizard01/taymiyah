<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ibnu Taemiyyah Model College — Student Report</title>
  <style>
    :root{
      --accent:#0b5f84;
      --muted:#6b7280;
      --paper:#fbfbfb;
      --table-header:#083a4a;
      --gold:#d7a24a;
      --soft:#eef6fa;
    }
    body{font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;margin:0;background:#f4f7f9;color:#12202b;padding:18px;}
    .container{max-width:980px;margin:0 auto;}
    .topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:64px;height:64px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--gold));color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:18px}
    .controls{display:flex;gap:10px;align-items:center}
    select, button{padding:8px 10px;border-radius:6px;border:1px solid #d9e6ec;background:white}
    .page{background:var(--paper);padding:18px;border-radius:8px;box-shadow:0 8px 30px rgba(12,40,60,0.06);border:1px solid rgba(10,30,40,0.04)}
    .student-row{display:flex;justify-content:space-between;gap:12px;align-items:flex-start;margin-bottom:12px}
    .info{flex:1;display:flex;gap:12px;align-items:center}
    .info .meta{background:#fff;padding:12px;border-radius:6px;border:1px solid #eef3f6;width:100%}
    .info .meta div{margin:4px 0}
    .stats{width:220px;text-align:right}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px 8px;border-bottom:1px solid #eef3f6;text-align:left;font-size:13px}
    thead th{background:linear-gradient(90deg,var(--table-header),#08546b);color:#fff;font-weight:700}
    .summary{display:flex;gap:12px;margin-top:12px}
    .card{flex:1;padding:12px;border-radius:8px;background:#fff;border:1px solid #eef3f6}
    .big{font-size:26px;font-weight:800;color:var(--accent)}
    .comments{display:flex;gap:12px;margin-top:12px}
    .comment-box{flex:1;padding:12px;border-radius:8px;background:#fff;border:1px solid #eef3f6}
    footer{margin-top:14px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between}
    .small{font-size:12px;color:var(--muted)}
    @media (max-width:800px){.student-row{flex-direction:column}.stats{text-align:left;width:100%}}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="logo">ITMC</div>
        <div>
          <h1>Ibnu Taemiyyah Model College</h1>
          <div class="small">Dynamic report generator — use the student dropdown to switch reports</div>
        </div>
      </div>

      <div class="controls">
        <label for="studentSelect" class="small">Select Student</label>
        <select id="studentSelect"></select>
        <button id="downloadPdf">Download PDF</button>
        <button id="exportJson">Export JSON</button>
      </div>
    </div>

    <div id="reportArea" class="page" role="document">
      <!-- Content injected by JS -->
    </div>

    <footer>
      <div>Generated by Data Alchemy Template</div>
      <div class="small">2025</div>
    </footer>
  </div>
<script src="database.js"></script>
<script>
// Fallback sample data (used if data.json cannot be fetched)
const fallbackData = {
  "school":"Ibnu Taemiyyah Model College",
  "session":"2024/2025",
  "term":"First Term",
  "students":[
    {
      "id":"S001",
      "name":"Abdullahi Titilayo",
      "class":"JSS1",
      "sex":"Male",
      "roll":"221382",
      "present":25,
      "total_mark_obtainable":360,
      "subjects":[
        {"name":"Mathematics","ca1":10,"ca2":20},
        {"name":"English","ca1":9,"ca2":18},
        {"name":"Yoruba","ca1":10,"ca2":10},
        {"name":"Islamic Studies","ca1":2,"ca2":4},
        {"name":"Arabic","ca1":12,"ca2":12},
        {"name":"Quran","ca1":10,"ca2":10},
        {"name":"Civic Education","ca1":12,"ca2":12},
        {"name":"Chemistry","ca1":11,"ca2":19},
        {"name":"Physics","ca1":11,"ca2":19},
        {"name":"Agric Science","ca1":11,"ca2":0},
        {"name":"Biology","ca1":19,"ca2":20},
        {"name":"Economics","ca1":8,"ca2":13}
      ],
      "class_teacher_comments":"He is a very brilliant student — keep it up.",
      "principal_comment":"Good performance; maintain consistency."
    },
    {
      "id":"S002",
      "name":"Aisha Bello",
      "class":"JSS1",
      "sex":"Female",
      "roll":"221383",
      "present":24,
      "total_mark_obtainable":360,
      "subjects":[
        {"name":"Mathematics","ca1":14,"ca2":18},
        {"name":"English","ca1":12,"ca2":16},
        {"name":"Yoruba","ca1":9,"ca2":11},
        {"name":"Islamic Studies","ca1":8,"ca2":10},
        {"name":"Arabic","ca1":10,"ca2":12},
        {"name":"Quran","ca1":9,"ca2":10},
        {"name":"Civic Education","ca1":10,"ca2":12},
        {"name":"Chemistry","ca1":13,"ca2":14},
        {"name":"Physics","ca1":12,"ca2":13},
        {"name":"Agric Science","ca1":10,"ca2":9},
        {"name":"Biology","ca1":15,"ca2":14},
        {"name":"Economics","ca1":10,"ca2":12}
      ],
      "class_teacher_comments":"Shows steady improvement in class.",
      "principal_comment":"Encouraging progress, work on weak areas."
    }
  ]
};

// Utility: calculate total, percentage, grade
function calcTotals(student){
  const subs = student.subjects || [];
  let total = 0;
  subs.forEach(s => {
    s.total = (Number(s['C.A Test'])||0) + (Number(s['EXAM'])||0);
    total += s.total;
  });
  student.total_obtained = total;
  student.percentage = student.total_mark_obtainable ? (total / student.total_mark_obtainable * 100) : 0;
  // simple grade mapping
  const p = student.percentage;
  if(p >= 70) student.grade = 'A';
  else if(p >= 60) student.grade = 'B';
  else if(p >= 50) student.grade = 'C';
  else if(p >= 40) student.grade = 'D';
  else student.grade = 'E';
  return student;
}

function renderReport(student, meta){
  student = calcTotals(student);
  const el = document.getElementById('reportArea');
  el.innerHTML = '';
  const header = document.createElement('div');
  header.className = 'student-row';
  header.innerHTML = `
    <div class="info">
      <div class="meta">
        <div><strong>Student's Name:</strong> ${student.name}</div>
        <div><strong>Roll No:</strong> ${student.roll}</div>
        <div><strong>Class:</strong> ${student.class}</div>
        <div><strong>Sex:</strong> ${student.sex}</div>
      </div>
    </div>
    <div class="stats">
      <div class="small">No. of times present</div>
      <div class="big">${student.present}</div>
      <div class="small" style="margin-top:8px">Total Mark Obtainable: <strong>${student.total_mark_obtainable}</strong></div>
    </div>
  `;
  el.appendChild(header);

  // table
  const table = document.createElement('table');
  table.innerHTML = `
    <thead><tr><th>Subject</th><th>CA1</th><th>CA2</th><th>Total</th><th>Grade</th></tr></thead>
    <tbody>
      ${student.subjects.map(s => `<tr>
        <td>${s.name}</td>
        <td>${s['C.A Test']}</td>
        <td>${s['EXAM']}</td>
        <td><strong>${s.total}</strong></td>
        <td>${(s.total >= 70 ? 'A' : s.total>=60 ? 'B' : s.total>=50 ? 'C' : s.total>=40 ? 'D' : 'E')}</td>
      </tr>`).join('')}
    </tbody>
  `;
  el.appendChild(table);

  // summary
  const summary = document.createElement('div');
  summary.className = 'summary';
  summary.innerHTML = `
    <div class="card">
      <div class="small">Total Mark Obtained</div>
      <div class="big">${student.total_obtained}</div>
      <div class="small" style="margin-top:6px">Out of ${student.total_mark_obtainable}</div>
    </div>
    <div class="card">
      <div class="small">Performance</div>
      <div class="big">${student.percentage.toFixed(2)}%</div>
      <div class="small" style="margin-top:6px">Grade: <strong>${student.grade}</strong></div>
    </div>
  `;
  el.appendChild(summary);

  // comments
  const comments = document.createElement('div');
  comments.className = 'comments';
  comments.innerHTML = `
    <div class="comment-box"><strong>Class Teacher's Comments</strong><p>${student.class_teacher_comments || ''}</p></div>
    <div class="comment-box"><strong>Principal's Comments</strong><p>${student.principal_comment || ''}</p></div>
  `;
  el.appendChild(comments);
}

// Load data.json; fallback to embedded data
async function loadData(){
  try{
    const json = SchoolData
    return json;
  }catch(err){
    console.warn('Could not load data.json, using fallback data.', err);
    return fallbackData;
  }
}

function populateStudentSelect(data){
  const sel = document.getElementById('studentSelect');
  sel.innerHTML = data.students.map((s,idx) => `<option value="${idx}">${s.name} — ${s.class} (${s.roll})</option>`).join('');
  sel.addEventListener('change', ()=>{
    const student = data.students[sel.value];
    renderReport(student, data);
  });
  // initial render
  if(data.students.length) renderReport(data.students[0], data);
}

// Export currently loaded JSON (download)
document.getElementById('exportJson').addEventListener('click', ()=>{
  if(window._loadedData){
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([JSON.stringify(window._loadedData, null, 2)], {type:'application/json'}));
    a.download = 'data-export.json';
    a.click();
  } else alert('No data loaded yet.');
});

// Download PDF (uses print to PDF)
document.getElementById('downloadPdf').addEventListener('click', ()=>{
  window.print();
});

// Initialize
(async ()=>{
  const data = await loadData();
  window._loadedData = data;
  populateStudentSelect(data);
})();
</script>
</body>
</html>
