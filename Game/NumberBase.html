<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Number Base Quiz (CBT)</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#1f4037,#99f2c8);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.card {
    background: #fff;
    max-width: 720px;
    width: 100%;
    padding: 25px;
    border-radius: 16px;
    text-align: center;
}
h2 { margin-top: 0; }

select {
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 6px;
}

.status {
    display: flex;
    justify-content: space-between;
    background: #f0f0f0;
    padding: 10px;
    border-radius: 10px;
    font-weight: bold;
    margin-bottom: 10px;
}

#question {
    font-size: 1.3rem;
    margin: 15px 0;
}

.options {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
    gap: 10px;
}

button {
    padding: 12px;
    background: #1f4037;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}
button:hover { background: #145a32; }

#feedback { margin-top: 10px; font-weight: bold; }
.correct { color: green; }
.wrong { color: red; }

#steps {
    margin-top: 15px;
    background: #f4f4f4;
    padding: 10px;
    display: none;
    text-align: left;
}
</style>
</head>

<body>

<div class="card">
<h2>üî¢ Number Base Quiz</h2>

<select id="mode" onchange="generateQuestion()">
    <option value="0">All Patterns (Random)</option>
    <option value="1">Base 2 ‚Üí Base 10</option>
    <option value="2">Base 10 ‚Üí Base 2</option>
    <option value="3">Base 10 ‚Üí Base (3‚Äì9)</option>
    <option value="4">Base (3‚Äì9) ‚Üí Base 10</option>
    <option value="5">Binary Addition / Subtraction</option>
    <option value="6">Binary Multiplication</option>
</select>

<div class="status">
    <span>‚è± Time: <span id="time">20</span>s</span>
    <span>‚≠ê Score: <span id="score">0/0</span></span>
    <span>üèÜ High: <span id="high">0</span></span>
</div>

<p id="question"></p>
<div class="options" id="options"></div>
<p id="feedback"></p>
<div id="steps"></div>
</div>

<audio id="correctSound" src="correct.mp3"></audio>
<audio id="gameOverSound" src="wrong.mp3"></audio>

<script>
let correctAnswer = "";
let attempts = 0, correct = 0;
let lock = false;
let timeLeft = 20;
let timer;

let highScore = localStorage.getItem("baseHighScore") || 0;
document.getElementById("high").textContent = highScore;

function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function toBase(n,b){ return n.toString(b); }

function startTimer(){
    clearInterval(timer);
    timeLeft = 20;
    document.getElementById("time").textContent = timeLeft;

    timer = setInterval(()=>{
        timeLeft--;
        document.getElementById("time").textContent = timeLeft;
        if(timeLeft<=0){
            gameOverSound.play();
            clearInterval(timer);
            lock = true;
            attempts++;
            document.getElementById("feedback").textContent = "‚è∞ Time Up!";
            document.getElementById("feedback").className = "wrong";
            updateScore();
            setTimeout(generateQuestion,1500);
        }
    },1000);
}

function updateScore(){
    document.getElementById("score").textContent = `${correct}/${attempts}`;
    if(correct > highScore){
        highScore = correct;
        localStorage.setItem("baseHighScore", highScore);
        document.getElementById("high").textContent = highScore;
    }
}

function generateQuestion(){
    clearInterval(timer);
    lock = false;
    document.getElementById("feedback").textContent = "";
    document.getElementById("steps").style.display = "none";

    let mode = Number(document.getElementById("mode").value);
    if(mode===0) mode = rand(1,6);

    let q="", s="", a="";
    let x, y, n, base;

    // ===== BASE 2 ‚Üí BASE 10 (FIXED) =====
    if(mode===1){
        n = rand(20,300);
        let b = toBase(n,2);
        q = `Convert ${b}‚ÇÇ to base 10`;
        a = n.toString();
        s = `${b}‚ÇÇ = ${a}‚ÇÅ‚ÇÄ`;
    }

    if(mode===2){
        n = rand(10,550);
        a = toBase(n,2);
        q = `Convert ${n}‚ÇÅ‚ÇÄ to base 2`;
        s = `Answer: ${a}‚ÇÇ`;
    }

    if(mode===3){
        base = rand(3,9);
        n = rand(15,70);
        a = toBase(n,base);
        q = `Convert ${n}‚ÇÅ‚ÇÄ to base ${base}`;
        s = `Answer: ${a}<sub>${base}</sub>`;
    }

    // ===== BASE (3‚Äì9) ‚Üí BASE 10 (FIXED) =====
    if(mode===4){
        base = rand(3,9);
        n = rand(20,120);
        let rep = toBase(n,base);
        q = `Convert ${rep}<sub>${base}</sub> to base 10`;
        a = n.toString();
        s = `Answer: ${a}`;
    }

    if(mode===5){
        x = rand(5,60); y = rand(3,x);
        let bx = toBase(x,2), by = toBase(y,2);
        if(Math.random()<0.5){
            q = `Add ${bx}‚ÇÇ + ${by}‚ÇÇ`;
            a = toBase(x+y,2);
        } else {
            q = `Subtract ${by}‚ÇÇ from ${bx}‚ÇÇ`;
            a = toBase(x-y,2);
        }
        s = `Answer: ${a}`;
    }

    if(mode===6){
        x = rand(3,14); y = rand(2,5);
        let bx = toBase(x,2), by = toBase(y,2);
        q = `Multiply ${bx}‚ÇÇ √ó ${by}‚ÇÇ`;
        a = toBase(x*y,2);
        s = `Answer: ${a}`;
    }

    correctAnswer = a;
    document.getElementById("question").innerHTML = q;

    // ===== SMART OPTIONS =====
    let opts = new Set([a]);

    // Decimal answer modes
    if(mode===1 || mode===4){
        let correctDec = Number(a);
        let wrongs = [
            correctDec + rand(1,4),
            correctDec - rand(1,4),
            Math.round(correctDec * 1.1),
            Math.round(correctDec * 0.9)
        ];

        for(let w of wrongs){
            if(w > 0 && opts.size < 4) opts.add(w.toString());
        }

        while(opts.size < 4){
            let near = correctDec + rand(-6,6);
            if(near > 0) opts.add(near.toString());
        }
    }

    // Binary multiplication handled separately
    else if(mode===6){
        let correctDec = x * y;
        let wrongs = [
            x + y,
            (x+1)*y,
            x*(y+1),
            Math.max(1,(x-1)*y)
        ];
        for(let w of wrongs){
            if(opts.size < 4) opts.add(toBase(w,2));
        }
        while(opts.size < 4){
            let near = correctDec + rand(-3,3);
            if(near > 0) opts.add(toBase(near,2));
        }
    }

    // Other modes
    else {
        while(opts.size < 4){
            opts.add(toBase(rand(1,70),2));
        }
    }

    document.getElementById("options").innerHTML =
        [...opts].sort(()=>Math.random()-0.5)
        .map(o=>`<button onclick="check('${o}',\`${s}\`)">${o}</button>`)
        .join("");

    startTimer();
}

function check(choice, steps){
    if(lock) return;
    lock = true;
    clearInterval(timer);
    attempts++;

    let f = document.getElementById("feedback");
    let st = document.getElementById("steps");

    if(choice === correctAnswer){
        correctSound.play();
        correct++;
        f.textContent = "‚úÖ Correct!";
        f.className = "correct";
    } else {
        gameOverSound.play();
        f.textContent = "‚ùå Wrong";
        f.className = "wrong";
    }

    updateScore();
    st.innerHTML = steps;
    st.style.display = "block";
    setTimeout(generateQuestion,3000);
}

generateQuestion();
</script>

</body>
</html>
